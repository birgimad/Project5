\subsection{Velocity-Verlet method}
\label{sec:methodVV}
- Remember to write about accuracy of algorithm!!

Consider the Taylor expansion of the vector function $\v{r}(t_i \pm \delta t)$:
\begin{align}
	\v{r}(t_i \pm \delta t) = \v{r}(t_i) \pm \v{v} (t_i) \delta t
	+ \v{a} (t_i) \frac{\delta t ^2}{2}  \pm \frac{\delta t ^3}{6} \frac{d^3 \v{r}(t_i)}{dt^3} + \mathcal{O}(\delta t ^4 )
	\label{eq:TaylorExpVVmethod}
\end{align}
Adding the two expressions in \matref{eq:TaylorExpVVmethod} gives
\begin{align}
	\v{r} (t_i +\delta t) = 2\v{r} (t_i) - \v{r} (t_i -\delta t)  + \v{a} (t_i ) \delta t^2 + \mathcal{O} (\delta t ^4 )
\end{align}
which has a truncation error that goes as $\mathcal{O} (\delta t ^4 )$.
\begin{align}
	\v{r}(t_i+\delta t) = \v{r}(t_i) + \v{v} (t_i) \delta t + \frac{1}{2} \v{a} (t_i) \delta t^2 
	\label{eq:VVmethodNextPosition}
\end{align}

\begin{align}
	\v{v} (t + \delta t) = \v{v} (t) + \frac{1}{2} ( \v{a} (t) + \v{a} (t + \delta t) ) \delta t
	\label{eq:VVmethodNextVelocity}
\end{align}
The velocity is in the algorithm calculated \fxnote{ad to gange} by first calculating 
\begin{align}
	\v{v}_{part1} (t + \delta t) = \v{v} (t) + \frac{1}{2}  \v{a} (t)  \delta t
	\label{eq:VVmethodNextVelocityPart1}
\end{align}
and then use ?? \fxnote{fix this!} to determine $\v{a} (t + \delta t)$, which is then used to compute the remaining term of \matref{eq:VVmethodNextVelocity} as 
\begin{align}
	\v{v}_{part2} (t + \delta t) = \frac{1}{2} \v{a} (t + \delta t) \delta t
	\label{eq:VVmethodNextVelocityPart2}
\end{align}

The velocity-Verlet method uses the algortihm \textit{Derivative} described in \secref{Newton2body3D}, to generate the six differential equations, in the following while-loop that runs until reaching the final time in time steps of length $\delta t = (t_{initial} - t_{final})/(\# time steps)$.
\begin{lstlisting}
    while(time<=t_final){
    Derivative(r,v,drdt,dvdt,G,mass);

    for(int i=0; i<6 ; i++){
    r[i] = r[i]+dt*drdt[i] + 0.5 * dt * dt * dvdt[i];
    v_partly[i] = drdt[i] + 0.5 * dt * dvdt[i];
    dvdt[i] = v_partly[i];
    }

    Derivative(r,v,drdt,dvdt,G,mass);

    for(int i=0; i<n ; i++){
    v[i] = v_partly[i] + 0.5 * dt * dvdt[i];
    }

    time += dt;
    }
\end{lstlisting}